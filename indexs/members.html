<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- bootstrap css -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/5.1.3/css/bootstrap.min.css">
    <!-- bootstrap js -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <!-- icons -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css">
    <!-- 自定义全局css 引用的是已注册的/static路径 -->
    <link rel="stylesheet" href="../static/css/ginkblog.css">
    <link rel="stylesheet" media="all" href="../static/css/gfm.css">
    <link rel="shortcut icon" href="../static/img/favicon.ico"/>
    <title>VLCS@SCU</title>
</head>

<body class="text-dark">

<!-- navbar -->
<div class="fixed-top">
    <nav class="navbar navbar-expand-lg navbar-light p-4 bg-light fw-bold">
        <div class="container">
            <a href="/" class="navbar-brand">VLCS@IoT@SCU</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navmenu">
                <!-- ms-auto : margin start - auto 向左推（将别的flexitem推到start处）-->
                <ul class="navbar-nav ms-auto" style="font-size: 1.1rem;">
                    <li class="nav-item">
                        <a href="/" class="nav-link">主页Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="/indexs/research.html" class="nav-link">研究Research</a>
                    </li>
                    <li class="nav-item">
                        <a href="/indexs/publicatons.html" class="nav-link">学术成果Publications</a>
                    </li>
                    <li class="nav-item">
                        <a href="/indexs/members.html" class="nav-link">成员Members</a>
                    </li>
                    <!-- <li class="nav-item">
                    <a href="/course" class="nav-link">课程Course</a>
                </li>
                <li class="nav-item">
                    <a href="/others" class="nav-link">其他Others</a>
                </li> -->
                    <!-- <li class="nav-item">
                        <a href="#" class="nav-link">吐槽版</a>
                    </li> -->
                </ul>
            </div>
        </div>
    </nav>
</div>
<!-- member -->

<section class="">
    <div class="container">
        <h3 class="mt-5 py-3 fw-bolder">课题组成员 Members</h3>

        <div style="border-top:1px dashed #000000;"></div>

        <div class="mt-4">
            <article id="members-markdown" class="markdown-body"></article>
        </div>
    </div>
</section>

<!-- footer -->
<footer class="p-5 mt-5 text-center">
    <div class="container">
        <p> Copyright &copy; <label id="cYear"></label> VLCS@SCU. All Rights Reserved.
            <!-- <a class="text-light" href="https://beian.miit.gov.cn/">蜀ICP备2022022252号-1</a> -->
        </p>
    </div>

</footer>

<script>setTimeout("cYear.innerHTML=new Date().getFullYear()", 100); </script>
<!-- Markdown render scripts -->
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    (function() {
        var target = document.getElementById('members-markdown');
        if (!target) return;
        fetch('../articles/members.md?_=' + Date.now())
            .then(function(res) { return res.text(); })
            .then(function(md) {
                var html = marked.parse(md);
                target.innerHTML = DOMPurify.sanitize(html);
                try { enhanceMembersLayout(target); } catch (e) { console.warn(e); }
            })
            .catch(function(err) {
                target.innerHTML = '<p>内容加载失败，请稍后重试。</p>';
                console.error(err);
            });
    })();

    function enhanceMembersLayout(root) {
        var sectionHeaders = root.querySelectorAll('h2');
        Array.prototype.forEach.call(sectionHeaders, function(h2) {
            var titleText = (h2.textContent || '').trim();
            if (!/负责人|Ph\.D|硕士生/.test(titleText)) return;

            var container = document.createElement('div');
            container.className = 'mt-lg-4 mt-md-2';

            var cursor = h2.nextElementSibling;
            var stopAt = (function() {
                var n = h2.nextElementSibling;
                while (n) {
                    if (n.tagName && n.tagName.toLowerCase() === 'h2') return n;
                    n = n.nextElementSibling;
                }
                return null;
            })();

            var members = [];
            var current = null;
            while (cursor && cursor !== stopAt) {
                if (cursor.tagName && cursor.tagName.toLowerCase() === 'h3') {
                    if (current) members.push(current);
                    current = { nameEl: cursor, blocks: [] };
                } else if (current) {
                    current.blocks.push(cursor);
                }
                cursor = cursor.nextElementSibling;
            }
            if (current) members.push(current);

            if (members.length === 0) return;

            // build member block elements
            var memberBlocks = members.map(function(item) {
                var name = (item.nameEl.textContent || '').trim();
                var avatarUrl = '';
                var textParts = [];

                item.blocks.forEach(function(node) {
                    if (node.tagName && node.tagName.toLowerCase() === 'p') {
                        var text = node.textContent || '';
                        var avatarMatch = text.match(/^\s*Avatar\s*:\s*(\S+)/i);
                        if (avatarMatch) {
                            avatarUrl = avatarMatch[1];
                            return; // skip adding this line
                        }
                    }
                    textParts.push(node.outerHTML || node.textContent || '');
                });

                if (!avatarUrl) avatarUrl = '../static/img/profile/null.png';

                // outer col for one person (half width on lg, full on small)
                var personCol = document.createElement('div');
                personCol.className = 'col-12 col-lg-6';

                // inner row keeps original image/text ratio
                var innerRow = document.createElement('div');
                innerRow.className = 'row my-3';

                var colImg = document.createElement('div');
                colImg.className = 'col-5 col-sm-4 col-md-3 col-lg-4';
                colImg.innerHTML = '<img src="' + avatarUrl + '" class="img-fluid" alt="Image">';

                var colText = document.createElement('div');
                colText.className = 'mt-3 col-7 col-sm-8 col-md-9 col-lg-8';
                var nameP = document.createElement('p');
                nameP.className = 'fw-bolder';
                nameP.textContent = name;
                colText.appendChild(nameP);
                var details = document.createElement('div');
                details.innerHTML = textParts.join('');
                colText.appendChild(details);

                innerRow.appendChild(colImg);
                innerRow.appendChild(colText);
                personCol.appendChild(innerRow);
                return personCol;
            });

            // append blocks two per row
            for (var i = 0; i < memberBlocks.length; i += 2) {
                var row = document.createElement('div');
                row.className = 'row';
                row.appendChild(memberBlocks[i]);
                if (memberBlocks[i + 1]) row.appendChild(memberBlocks[i + 1]);
                container.appendChild(row);
            }

            // remove original nodes between h2 and next h2, then insert container
            var toRemove = [];
            var n = h2.nextElementSibling;
            while (n && n !== stopAt) { toRemove.push(n); n = n.nextElementSibling; }
            toRemove.forEach(function(el) { el.parentNode.removeChild(el); });
            h2.parentNode.insertBefore(container, stopAt);
        });
    }
</script>

</body>


</html>